<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quy·ªÅn Anh Sport Shop</title>

<style>
  body { font-family: Arial; padding: 20px; background-color: #f8f8f8; }
  header { text-align:center; margin-bottom:20px; }
  header h1 { color:#ff4500; font-family: 'Arial Black', sans-serif; }
  input[type="text"] { width:100%; max-width:400px; padding:10px; font-size:16px; border:2px solid #ff4500; border-radius:8px; margin-bottom:20px; }
  #result { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:20px; }
  .card { border:1px solid #ddd; padding:15px; background:#fff; box-shadow:0 3px 6px rgba(0,0,0,0.1); border-radius:10px; text-align:center; transition:transform 0.2s, border 0.2s; }
  .card:hover { transform:translateY(-5px); box-shadow:0 5px 10px rgba(0,0,0,0.2); }
  .card.selected { border:2px solid red; }
  .card img { width:100%; height:150px; object-fit:contain; margin-top:10px; }
  .card input[type="checkbox"] { margin-right:5px; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  table th, table td { padding:10px; text-align:center; }
  table th { background-color:#ff4500; color:#fff; }
  table, th, td { border:1px solid #ddd; }
  #cart, #orderResult { margin-top:30px; display:none; }
  #cart input[type="number"] { width:60px; padding:5px; border-radius:5px; border:1px solid #ccc; }
  button { margin-top:10px; padding:10px 20px; background:#ff4500; color:#fff; border:none; border-radius:5px; cursor:pointer; font-size:16px; }
  button:hover { background:#e03e00; }
  /* Popup x√°c nh·∫≠n */
  .popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center; }
  .popup .popup-content { background:#fff; padding:20px; border-radius:10px; max-width:400px; width:90%; text-align:center; }
  .popup .popup-content h2 { margin-bottom:10px; }
  .popup .popup-content button { margin:10px 5px; }
  .popup input { width:80%; padding:8px; margin:5px 0; font-size:14px; border:1px solid #ccc; border-radius:5px; }
</style>
</head>
<body>

<header>
  <img src="images/logo.png" alt="Quy·ªÅn Anh Shop" style="height:80px;">
  <h1>Quy·ªÅn Anh Sport Shop</h1>
  <p>Chuy√™n ƒë·ªì th·ªÉ thao ch·∫•t l∆∞·ª£ng cao</p>
  <img src="images/banner.jpg" alt="Banner" style="width:100%; max-height:200px; object-fit:cover; border-radius:10px;">
</header>

<h2>üîç Tra c·ª©u gi√° s·∫£n ph·∫©m</h2>
<input type="text" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." onkeyup="searchProduct(this.value)">

<div id="result"></div>

<div id="cart">
  <h3>Gi·ªè h√†ng</h3>
  <table>
    <thead>
      <tr>
        <th>S·∫£n ph·∫©m</th>
        <th>Gi√°</th>
        <th>S·ªë l∆∞·ª£ng</th>
        <th>Th√†nh ti·ªÅn</th>
      </tr>
    </thead>
    <tbody id="cartBody"></tbody>
    <tfoot>
      <tr>
        <td colspan="3" style="text-align:right;"><b>T·ªïng ti·ªÅn:</b></td>
        <td id="cartTotal">0 ƒë</td>
      </tr>
      <tr>
        <td colspan="3" style="text-align:right;"><b>Thu·∫ø (5%):</b></td>
        <td id="cartTax">0 ƒë</td>
      </tr>
      <tr>
        <td colspan="3" style="text-align:right;"><b>Thanh to√°n:</b></td>
        <td id="cartFinal">0 ƒë</td>
      </tr>
    </tfoot>
  </table>
  <button onclick="placeOrder()">ƒê·∫∑t h√†ng</button>
</div>

<div id="orderResult">
  <h3>ƒê∆°n h√†ng c·ªßa b·∫°n</h3>
  <table>
    <thead>
      <tr>
        <th>S·∫£n ph·∫©m</th>
        <th>Gi√°</th>
        <th>S·ªë l∆∞·ª£ng</th>
        <th>Th√†nh ti·ªÅn</th>
      </tr>
    </thead>
    <tbody id="orderBody"></tbody>
  </table>
</div>

<!-- Popup x√°c nh·∫≠n ƒë·∫∑t h√†ng -->
<div id="confirmPopup" class="popup">
  <div class="popup-content">
    <h2>Quy·ªÅn Anh Sport Shop</h2>
    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë·∫∑t h√†ng kh√¥ng?</p>
    <button onclick="closePopup()">Kh√¥ng</button>
    <button onclick="showCustomerInfoPopup()">C√≥</button>
  </div>
</div>

<!-- Popup nh·∫≠p th√¥ng tin kh√°ch h√†ng -->
<div id="customerInfoPopup" class="popup">
  <div class="popup-content">
    <h2>Quy·ªÅn Anh Sport Shop</h2>
    <p>Qu√Ω kh√°ch vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ v√† s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ x√°c nh·∫≠n ƒë∆°n h√†ng</p>
    <input type="text" id="customerAddress" placeholder="ƒê·ªãa ch·ªâ"><br>
    <input type="text" id="customerPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i"><br>
    <button onclick="confirmCustomerInfo()">X√°c nh·∫≠n</button>
    <button onclick="closeCustomerInfoPopup()">H·ªßy</button>
  </div>
</div>

<script src="data.js"></script>
<script>
const selectedProducts = {};
let orderCount = 0;

// Telegram
const telegramBotToken = "8273857573:AAEYcSW6HxSq_IJ8oNJfKrq6tVxhVUA3Y8U";
const telegramChatId = "6403555640";

function capitalizeWords(str) {
  return str.replace(/\b\w/g, c => c.toUpperCase());
}

// Hi·ªÉn th·ªã s·∫£n ph·∫©m
function displayProducts(productsToShow) {
  const result = document.getElementById("result");
  result.innerHTML = productsToShow.map(p => {
    const index = products.indexOf(p);
    return `
      <div class="card ${selectedProducts[index] ? 'selected' : ''}">
        <b>${capitalizeWords(p.name)}</b>
        <div class="price">${p.price>0 ? p.price.toLocaleString() + ' ƒë' : 'Li√™n h·ªá ƒë·ªÉ bi·∫øt gi√°'}</div>
        <img src="${p.image}" alt="${p.name}">
        ${p.price>0 ? `<div style="margin-top:10px;">
          <input type="checkbox" id="select-${index}" onchange="updateCart(${index})" ${selectedProducts[index] ? 'checked' : ''}> Ch·ªçn s·∫£n ph·∫©m
        </div>` : ''}
      </div>
    `;
  }).join("");
}

// C·∫≠p nh·∫≠t gi·ªè h√†ng
function updateCart(index) {
  const checkbox = document.getElementById(`select-${index}`);
  const cart = document.getElementById('cart');
  const cartBody = document.getElementById('cartBody');
  const card = checkbox.closest('.card');
  const p = products[index];

  if(checkbox.checked){
    selectedProducts[index] = true;
    card.classList.add('selected');
    if(!document.getElementById(`cartRow-${index}`)){
      const row = document.createElement('tr');
      row.id = `cartRow-${index}`;
      row.innerHTML = `
        <td>${capitalizeWords(p.name)}</td>
        <td>${p.price.toLocaleString()} ƒë</td>
        <td><input type="number" min="1" value="1" id="cartQty-${index}" onchange="updateCartTotal()"></td>
        <td id="cartItemTotal-${index}">${p.price.toLocaleString()} ƒë</td>
      `;
      cartBody.appendChild(row);
    }
  } else {
    delete selectedProducts[index];
    card.classList.remove('selected');
    const row = document.getElementById(`cartRow-${index}`);
    if(row) row.remove();
  }
  cart.style.display = cartBody.children.length > 0 ? 'block' : 'none';
  updateCartTotal();
}

// T√≠nh t·ªïng ti·ªÅn v√† thu·∫ø 5%
function updateCartTotal() {
  let total = 0;
  products.forEach((p,index)=>{
    const qtyInput = document.getElementById(`cartQty-${index}`);
    const itemTotalCell = document.getElementById(`cartItemTotal-${index}`);
    if(qtyInput && itemTotalCell){
      const qty = parseInt(qtyInput.value)||0;
      const itemTotal = p.price*qty;
      itemTotalCell.innerText = itemTotal.toLocaleString() + ' ƒë';
      total += itemTotal;
    }
  });
  const tax = total*0.05;
  const final = total + tax;
  document.getElementById('cartTotal').innerText = total.toLocaleString()+' ƒë';
  document.getElementById('cartTax').innerText = tax.toLocaleString()+' ƒë';
  document.getElementById('cartFinal').innerText = final.toLocaleString()+' ƒë';
}

// N√∫t ƒë·∫∑t h√†ng
function placeOrder() {
  if(Object.keys(selectedProducts).length===0){
    alert("B·∫°n ch∆∞a ch·ªçn s·∫£n ph·∫©m n√†o!");
    return;
  }
  document.getElementById('confirmPopup').style.display='flex';
}

function closePopup() { document.getElementById('confirmPopup').style.display='none'; }

function showCustomerInfoPopup() {
  closePopup();
  document.getElementById('customerInfoPopup').style.display='flex';
}

function closeCustomerInfoPopup() { document.getElementById('customerInfoPopup').style.display='none'; }

// G·ª≠i ƒë∆°n h√†ng qua Telegram
function sendOrderToTelegram(address, phone) {
  let message = `üíå ƒê∆°n h√†ng t·ª´ Quy·ªÅn Anh Sport Shop\n\nKh√°ch h√†ng: ${address}\nSƒêT: ${phone}\n\nChi ti·∫øt ƒë∆°n h√†ng:\n`;
  let total = 0;
  for (let index in selectedProducts) {
    const p = products[index];
    const qty = parseInt(document.getElementById(`cartQty-${index}`).value)||0;
    const itemTotal = p.price*qty;
    total += itemTotal;
    message += `${capitalizeWords(p.name)} - ${p.price.toLocaleString()} ƒë x ${qty} = ${itemTotal.toLocaleString()} ƒë\n`;
  }
  const tax = total*0.05;
  const final = total + tax;
  message += `\nThu·∫ø 5%: ${tax.toLocaleString()} ƒë\nT·ªïng thanh to√°n: ${final.toLocaleString()} ƒë`;

  fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage?chat_id=${telegramChatId}&text=${encodeURIComponent(message)}`)
    .then(res=>console.log("G·ª≠i Telegram th√†nh c√¥ng!"))
    .catch(err=>console.error("G·ª≠i Telegram th·∫•t b·∫°i", err));
}

// X√°c nh·∫≠n th√¥ng tin kh√°ch h√†ng
function confirmCustomerInfo() {
  const address = document.getElementById('customerAddress').value.trim();
  const phone = document.getElementById('customerPhone').value.trim();
  if(!address || !phone){
    alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ƒë·ªãa ch·ªâ v√† s·ªë ƒëi·ªán tho·∫°i!");
    return;
  }

  const orderBody = document.getElementById('orderBody');
  orderCount++;
  
  // Kho·∫£ng c√°ch / m√†u v√†ng nh·∫°t
  const separator = document.createElement('div');
  separator.style.backgroundColor = '#fff8dc';
  separator.style.padding = '10px';
  separator.style.marginTop = '20px';
  separator.innerHTML = `<b>ƒê∆°n h√†ng s·ªë ${orderCount} - Kh√°ch h√†ng: ${address}, ${phone}</b>`;
  orderBody.appendChild(separator);

  let total=0;
  for(let index in selectedProducts){
    const p = products[index];
    const qty = parseInt(document.getElementById(`cartQty-${index}`).value)||0;
    const itemTotal = p.price*qty;
    total += itemTotal;

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${capitalizeWords(p.name)}</td>
      <td>${p.price.toLocaleString()} ƒë</td>
      <td>${qty}</td>
      <td>${itemTotal.toLocaleString()} ƒë</td>
    `;
    orderBody.appendChild(row);
  }

  const tax = total*0.05;
  const final = total + tax;

  const totalRow = document.createElement('tr');
  totalRow.style.fontWeight='bold';
  totalRow.innerHTML = `
    <td colspan="3" style="text-align:right;">T·ªïng ƒë∆°n h√†ng (c√≥ thu·∫ø 5%):</td>
    <td>${final.toLocaleString()} ƒë</td>
  `;
  orderBody.appendChild(totalRow);

  document.getElementById('orderResult').style.display='block';
  document.getElementById('orderResult').scrollIntoView({behavior:'smooth'});

  // G·ª≠i Telegram
  sendOrderToTelegram(address, phone);

  // Reset gi·ªè h√†ng
  for(let index in selectedProducts){
    document.getElementById(`select-${index}`).checked = false;
    const row = document.getElementById(`cartRow-${index}`);
    if(row) row.remove();
    const card = document.querySelectorAll('.card')[index];
    if(card) card.classList.remove('selected');
  }
  for(let key in selectedProducts) delete selectedProducts[key];
  document.getElementById('cart').style.display='none';
  closeCustomerInfoPopup();

  document.getElementById('customerAddress').value = '';
  document.getElementById('customerPhone').value = '';
}

// T√¨m ki·∫øm s·∫£n ph·∫©m
function searchProduct(keyword){
  if(!keyword){
    displayProducts(products);
    return;
  }
  const matches = products.filter(p => p.name.toLowerCase().includes(keyword.toLowerCase()));
  displayProducts(matches);
}

// Load trang
window.onload = ()=>{ displayProducts(products); };
</script>

</body>
</html>
