<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quy·ªÅn Anh Sport Shop</title>

<style>
  body { font-family: Arial; padding: 20px; background-color: #f8f8f8; }
  header { text-align:center; margin-bottom:20px; }
  header h1 { color:#ff4500; font-family: 'Arial Black', sans-serif; }
  input[type="text"] { width:100%; max-width:400px; padding:10px; font-size:16px; border:2px solid #ff4500; border-radius:8px; margin-bottom:20px; }
  #result { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:20px; }
  .card { border:1px solid #ddd; padding:15px; background:#fff; box-shadow:0 3px 6px rgba(0,0,0,0.1); border-radius:10px; text-align:center; }
  .card.selected { border:2px solid red; }
  .card img { width:100%; height:150px; object-fit:contain; margin-top:10px; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  table, th, td { border:1px solid #ddd; }
  th, td { padding:10px; text-align:center; }
  th { background:#ff4500; color:#fff; }
  #cart, #orderResult { margin-top:30px; display:none; }
  button { margin-top:10px; padding:10px 20px; background:#ff4500; color:#fff; border:none; border-radius:5px; cursor:pointer; }
  .popup { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
  .popup-content { background:#fff; padding:20px; border-radius:10px; width:90%; max-width:400px; text-align:center; }
</style>
</head>

<body>

<header>
  <img src="./images/logo.png" style="height:80px">
  <h1>Quy·ªÅn Anh Sport Shop</h1>
  <img src="./images/banner.jpg" style="width:100%;max-height:200px;object-fit:cover;border-radius:10px">
</header>

<input type="text" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." onkeyup="searchProduct(this.value)">

<div id="result"></div>

<div id="cart">
  <h3>Gi·ªè h√†ng</h3>
  <table>
    <thead>
      <tr><th>S·∫£n ph·∫©m</th><th>Gi√°</th><th>SL</th><th>Ti·ªÅn</th></tr>
    </thead>
    <tbody id="cartBody"></tbody>
    <tfoot>
      <tr><td colspan="3">T·ªïng</td><td id="cartTotal">0 ƒë</td></tr>
      <tr><td colspan="3">Thu·∫ø 5%</td><td id="cartTax">0 ƒë</td></tr>
      <tr><td colspan="3"><b>Thanh to√°n</b></td><td id="cartFinal">0 ƒë</td></tr>
    </tfoot>
  </table>
  <button onclick="placeOrder()">ƒê·∫∑t h√†ng</button>
</div>

<div id="orderResult">
  <h3>ƒê∆°n h√†ng</h3>
  <table>
    <thead>
      <tr><th>S·∫£n ph·∫©m</th><th>Gi√°</th><th>SL</th><th>Ti·ªÅn</th></tr>
    </thead>
    <tbody id="orderBody"></tbody>
  </table>
</div>

<div id="confirmPopup" class="popup">
  <div class="popup-content">
    <p>X√°c nh·∫≠n ƒë·∫∑t h√†ng?</p>
    <button onclick="closePopup()">Kh√¥ng</button>
    <button onclick="showCustomerInfoPopup()">C√≥</button>
  </div>
</div>

<div id="customerInfoPopup" class="popup">
  <div class="popup-content">
    <input id="customerAddress" placeholder="ƒê·ªãa ch·ªâ">
    <input id="customerPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i">
    <br><br>
    <button onclick="confirmCustomerInfo()">X√°c nh·∫≠n</button>
  </div>
</div>

<!-- DATA -->
<script src="./data.js"></script>

<script>
const selectedProducts = {};
let orderCount = 0;

// TELEGRAM
const telegramBotToken = "8273857573:AAEYcSW6HxSq_IJ8oNJfKrq6tVxhVUA3Y8U";
const telegramChatId = "6403555640";

function displayProducts(list){
  const r=document.getElementById("result");
  r.innerHTML=list.map(p=>{
    const i=products.indexOf(p);
    return `
    <div class="card ${selectedProducts[i]?'selected':''}">
      <b>${p.name}</b><br>${p.price.toLocaleString()} ƒë
      <img src="./${p.image}">
      <br>
      <input type="checkbox" onchange="updateCart(${i})" ${selectedProducts[i]?'checked':''}>
    </div>`;
  }).join("");
}

function updateCart(i){
  const body=document.getElementById("cartBody");
  if(selectedProducts[i]){
    delete selectedProducts[i];
    document.getElementById("row"+i)?.remove();
  }else{
    selectedProducts[i]=true;
    body.innerHTML+=`
    <tr id="row${i}">
      <td>${products[i].name}</td>
      <td>${products[i].price.toLocaleString()}</td>
      <td><input type="number" value="1" min="1" onchange="calc()"></td>
      <td>${products[i].price.toLocaleString()}</td>
    </tr>`;
  }
  document.getElementById("cart").style.display=Object.keys(selectedProducts).length?"block":"none";
  calc();
}

function calc(){
  let t=0;
  document.querySelectorAll("#cartBody tr").forEach(r=>{
    const price=parseInt(r.children[1].innerText.replace(/\D/g,''));
    const qty=r.children[2].children[0].value;
    r.children[3].innerText=(price*qty).toLocaleString();
    t+=price*qty;
  });
  document.getElementById("cartTotal").innerText=t.toLocaleString()+" ƒë";
  document.getElementById("cartTax").innerText=(t*0.05).toLocaleString()+" ƒë";
  document.getElementById("cartFinal").innerText=(t*1.05).toLocaleString()+" ƒë";
}

function placeOrder(){document.getElementById("confirmPopup").style.display="flex";}
function closePopup(){document.getElementById("confirmPopup").style.display="none";}
function showCustomerInfoPopup(){closePopup();document.getElementById("customerInfoPopup").style.display="flex";}

function sendOrderToTelegram(msg){
  fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`,{
    method:"POST",
    mode:"no-cors",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({chat_id:telegramChatId,text:msg})
  });
}

function confirmCustomerInfo(){
  let msg="üõí ƒê∆†N H√ÄNG M·ªöI\n";
  document.querySelectorAll("#cartBody tr").forEach(r=>{
    msg+=`${r.children[0].innerText} x ${r.children[2].children[0].value}\n`;
  });
  sendOrderToTelegram(msg);
  document.getElementById("customerInfoPopup").style.display="none";
}

function searchProduct(k){
  displayProducts(!k?products:products.filter(p=>p.name.toLowerCase().includes(k.toLowerCase())));
}

window.onload=()=>displayProducts(products);
</script>

</body>
</html>
